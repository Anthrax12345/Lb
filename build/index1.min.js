/*! libarymanagement 2016-11-02 */
var app=angular.module("MyApp",["ngRoute","ngMaterial","ngMessages"]);app.config(["$routeProvider",function(a){a.when("/addnewbook",{templateUrl:"addnewbook.html"}).when("/addnewauthor",{templateUrl:"addnewauthor.html"}).when("/",{templateUrl:"homepage.html"}).when("/authordetails",{templateUrl:"authordetails.html"}).when("/bookdetails",{templateUrl:"bookdetails.html"})}]),app.service("libaryService",[function(){this.libary="",this.authors="",this.books="",this.selectedBook="",this.selectedAuthor="",this.getBook=function(a){"object"==typeof a&&(a=a.ISBN);for(var b=0;b<this.books.length;b++)if(this.books[b].ISBN==a)return this.books[b];return"no Books found"},this.getAuthor=function(a){a=parseInt(a);for(var b=0;b<this.authors.length;b++)if(this.authors[b].Id==a)return this.authors[b];return"No author present"},this.checkISBN=function(a){var b="";b="object"==typeof a?a.ISBN:a;for(var c=0;c<this.books.length;c++)if(this.books[c].ISBN==b)return!0;return!1},this.addBook=function(a){return this.checkISBN!==!0&&(this.books.push(a),!0)},this.addAuthor=function(a){this.authors.push(a)},this.generateAuthorId=function(){for(var a=[],b=0,c=0;c<this.authors.length;c++)a.push(parseInt(this.authors[c].Id));return a.sort(),b=a[a.length-1]+1},this.deleteAuthor=function(a){for(var b=0;b<this.authors.length;b++)if(this.authors[b].Id==a)return void this.authors.splice(b,1);return"No author present"},this.deleteBook=function(a){for(var b=0;b<this.books.length;b++)if(this.books[b].ISBN===a)return void this.books.splice(b,1);return"No such books"}}]),app.directive("ankSearchTable",function(){return{restrict:"E",templateUrl:"tablecontent.html"}}),app.controller("mainController",["$scope","libaryService","$http","$mdDialog",function(a,b,c,d){c({method:"GET",url:"/data.json"}).then(function(a){b.libary=a.data,b.authors=a.data.libary.Authors,b.books=a.data.libary.Books},function(a){b.libary=a}),a.links=["active","",""],a.linksClicked=function(b){for(var c=0;c<a.links.length;c++)b===c?a.links[c]="active":a.links[c]=""}}]),app.controller("homepagecontroller",["$location","$scope","libaryService",function(a,b,c){b.tablecontent=angular.copy(c.books);for(var d=0;d<c.books.length;d++)b.tablecontent[d].AuthorName=c.getAuthor(b.tablecontent[d].authorId).AuthorName,void 0===b.tablecontent[d].AuthorName&&(b.tablecontent[d].AuthorName="No Author Found");b.bookDetails=function(a){var b=parseInt(a.target.id||a.srcElement.id);c.selectedBook=c.getBook(b)},b.authorDetails=function(a){var b=parseInt(a.target.id||a.srcElement.id);c.selectedAuthor=c.getAuthor(b)};var e="glyphicon glyphicon-triangle-bottom",f="glyphicon glyphicon-triangle-top";b.thIcon=["glyphicon glyphicon-triangle-bottom","",""],b.sortOrder="ISBN",b.direction="",b.thClicked=function(a,c){b.sortOrder=c,b.direction=""===b.direction?"reverse":"",b.thIcon[a]=b.thIcon[a]===e?f:e;for(var d=0;d<b.thIcon.length;d++)d!=a&&(b.thIcon[d]="")}}]),app.controller("authordetailscontroller",["$scope","$location","$mdDialog","libaryService",function(a,b,c,d){a.author=d.selectedAuthor,a.newauthor=angular.copy(a.author),a.saveDetails=function(){a.author.AuthorName=a.newauthor.AuthorName,a.author.Email=a.newauthor.Email,a.author.Department=a.newauthor.Department,a.author.Website=a.newauthor.Website,a.author.Skills=a.newauthor.Skills},a.deleteAuthor=function(e){var f=c.confirm().title("Would you like to delete Author: "+a.author.AuthorName+" ?").textContent("Some of book may still have author with same name.").ariaLabel("Deleting Author").targetEvent(e).ok("Delete Author").cancel("Cancel ");c.show(f).then(function(){d.deleteAuthor(parseInt(a.author.Id)),b.path("/")},function(){})}}]),app.controller("bookdetailscontroller",["$location","$mdDialog","$scope","libaryService",function(a,b,c,d){c.book=d.selectedBook,c.book.availableOn=new Date(c.book.availableOn),c.newAuthorId=parseInt(c.book.authorId),c.authors=d.authors,c.authorName=d.getAuthor(c.book.authorId).AuthorName,c.editbook=angular.copy(c.book),c.editbook.availableOn=new Date,c.date1=new Date,c.minDate=new Date(c.date1.getFullYear(),c.date1.getMonth(),c.date1.getDate()),c.saveDetails=function(){c.book.authorId=parseInt(c.newAuthorId),c.book.BookTitle=c.editbook.BookTitle,c.book.price=c.editbook.price,c.book.availableOn=c.editbook.availableOn,$http({method:"PUT",data:d,url:"/data2.json"}).then(function(a){abc=a.data,d.libary=a.data,d.authors=a.data.libary.Authors,d.books=a.data.libary.Books},function(a){d.libary=a})},c.deleteBook=function(e){var f=b.confirm().title("Would you like to delete Book: "+c.book.BookTitle+" ?").textContent("Once Delete this book cannot be retrieve back").ariaLabel("Deleting Book").targetEvent(e).ok("Delete book").cancel("Cancel ");b.show(f).then(function(){d.deleteBook(c.book.ISBN),a.path("/")},function(){})}}]),app.controller("newbookcontroller",["$location","$scope","libaryService",function(a,b,c){b.newBook={},b.newBook.availableOn=new Date,b.duplicateISBN=!1,b.authors=c.authors,b.date1=new Date,b.minDate=new Date(b.date1.getFullYear(),b.date1.getMonth(),b.date1.getDate()),b.addBook=function(){c.addBook(b.newBook)===!1?alert("ISBN already present"):a.path("/")},b.checkISBN=function(){c.checkISBN(b.newBook.ISBN)===!0?b.duplicateISBN=!0:b.duplicateISBN=!1},b.bookRedirect=function(){c.selectedBook=c.getBook(b.newBook.ISBN)}}]),app.controller("addnewauthorcontroller",["$location","$scope","libaryService",function(a,b,c){b.newAuthor={},b.newAuthor.Id=c.generateAuthorId(),b.addAuthor=function(){c.addAuthor(b.newAuthor),a.path("/")}}]);